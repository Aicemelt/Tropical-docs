# [기능 명세서] 일기 및 일정 관리

- **담당자:** `신동준`
- **최종 수정일:** `2025-09-09`

## 1. 개요

본 기능은 사용자가 자신의 일정(Schedule)과 일기(Diary)를 기록하고 관리하는 시스템을 구축하는 것을 목표로 한다. 기록된 데이터는 사용자의 삶을 체계적으로 관리하는 도구가 될 뿐만 아니라, **AI가 사용자의 상황과 감정을 분석하여 개인화된 '스몰토크' 주제를 추천하는 핵심 재료**로 활용된다.

사용자는 캘린더 뷰를 통해 자신의 일정과 그날 작성한 일기를 한눈에 파악할 수 있으며, 각 기록에 대한 생성(Create), 조회(Read), 수정(Update), 삭제(Delete) 기능을 지원한다.

---

## 2. 데이터베이스 스키마

### 2.1. `Schedule` (일정) 테이블

| 컬럼명 | 데이터 타입 | 제약 조건 | 설명 |
| :--- | :--- | :--- | :--- |
| `schedule_id` | `BIGINT` | `PK` | 일정 고유 ID (Auto Increment) |
| `user_id` | `BIGINT` | `FK`, `Not Null` | 사용자 ID (`User` 테이블 참조) |
| `title` | `VARCHAR(255)` | `Not Null` | 일정 제목 |
| `memo` | `TEXT` | `Nullable` | 일정 관련 메모 |
| `schedule_date` | `DATE` | `Not Null` | 일정 날짜 (캘린더 표시 기준) |
| `start_time` | `TIME` | `Nullable` | 일정 시작 시간 |
| `end_time` | `TIME` | `Nullable` | 일정 종료 시간 |
| `location` | `VARCHAR(100)`| `Nullable` | 일정 장소 |
| `attendees` | `VARCHAR(255)`| `Nullable` | 참여자 (쉼표로 구분된 문자열, 예: "부장님, 과장님") |
| `is_completed` | `BOOLEAN` | `Default false` | 일정 완료 여부 |
| `created_at` | `DATETIME` | `Default NOW()` | 레코드 생성일 |
| `updated_at` | `DATETIME` | `Default NOW()` | 레코드 수정일 |

### 2.2. `Diary` (일기) 테이블

| 컬럼명 | 데이터 타입 | 제약 조건 | 설명 |
| :--- | :--- | :--- | :--- |
| `diary_id` | `BIGINT` | `PK` | 일기 고유 ID |
| `user_id` | `BIGINT` | `FK`, `Not Null` | 사용자 ID (`User` 테이블 참조) |
| `title` | `VARCHAR(255)` | `Not Null` | 일기 제목 |
| `content` | `TEXT` | `Not Null` | 일기 본문 내용 |
| `emotion` | `VARCHAR(20)` | `Not Null` | 감정 (Enum: `JOY`, `SADNESS`, `ANGER` 등) |
| `weather` | `VARCHAR(20)` | `Not Null` | 날씨 (Enum: `SUNNY`, `CLOUDY`, `RAINY` 등) |
| `diary_date` | `DATE` | `Not Null` | 일기 날짜 (캘린더 표시 기준) |
| `created_at` | `DATETIME` | `Default NOW()` | 레코드 생성일 |
| `updated_at` | `DATETIME` | `Default NOW()` | 레코드 수정일 |

---

## 3. 기능 요구사항

### 3.1. 공통 기능

| 기능 ID | 기능명 | 상세 설명 | 비고 |
| :--- | :--- | :--- | :--- |
| `CD-01` | **월별 캘린더 뷰** | 사용자는 월별 캘린더를 통해 자신의 모든 일정과 일기를 한눈에 볼 수 있다. <br> - 일정이 있는 날짜와 일기가 있는 날짜는 시각적으로 구분되어야 한다. (예: 점, 아이콘) | 프론트엔드 핵심 뷰 |
| `CD-02` | **날짜별 상세 뷰** | 캘린더에서 특정 날짜를 클릭하면, 일정과 일기를 작성할 수 있는 버튼과 해당 날짜의 일정 목록(드롭다운)과 작성된 일기가 하단에 표시되고 해당 일정이나 일기를 클릭 시 상세 정보를 볼 수 있다. | UI/UX 중요 |

### 3.2. 일정(Schedule) 관리 기능

| 기능 ID | 기능명 | 상세 설명 | API 엔드포인트 (예시) | HTTP Method |
| :--- | :--- | :--- | :--- | :--- |
| `S-C-01` | **일정 생성** | 사용자는 날짜, 시간, 제목, 장소, 참여자 등의 정보를 포함한 새 일정을 등록할 수 있다. | `/api/schedules` | `POST` |
| `S-R-01` | **월별 일정 조회** | 사용자가 캘린더 뷰에서 특정 월을 선택하면, 해당 월에 포함된 모든 일정을 조회할 수 있다. | `/api/schedules?year=2025&month=9` | `GET` |
| `S-R-02` | **일정 상세 조회** | 사용자가 특정 일정을 클릭하면, 제목, 메모, 시간, 장소 등 모든 상세 정보를 볼 수 있다. | `/api/schedules/{schedule_id}` | `GET`|
| `S-U-01` | **일정 수정** | 사용자는 기존에 생성했던 일정의 모든 정보를 수정할 수 있다. | `/api/schedules/{schedule_id}` | `PUT` |
| `S-U-02` | **일정 완료 처리** | 사용자는 To-Do-List처럼 일정의 완료 여부(`is_completed`)를 체크/해제할 수 있다. (캘린더 뷰에서 바로 처리) | `/api/schedules/{schedule_id}/complete` | `PUT` |
| `S-D-01` | **일정 삭제** | 사용자는 더 이상 필요 없는 일정을 삭제할 수 있다. | `/api/schedules/{schedule_id}` | `DELETE` |

### 3.3. 일기(Diary) 관리 기능

| 기능 ID | 기능명 | 상세 설명 | API 엔드포인트 (예시) | HTTP Method |
| :--- | :--- | :--- | :--- | :--- |
| `D-C-01` | **일기 작성** | 사용자는 특정 날짜를 선택하여 제목, 내용, 감정, 날씨를 포함한 새 일기를 작성할 수 있다. | `/api/diaries` | `POST` |
| `D-R-01` | **일기 상세 조회** | 사용자가 캘린더 뷰에서 작성된 일기를 클릭하면, 해당 일기의 전체 내용을 볼 수 있다. | `/api/diaries/{diary_id}` | `GET` |
| `D-R-02` | **특정 날짜 일기 조회** | 사용자가 캘린더에서 특정 날짜를 선택하면, 해당 날짜에 작성된 모든 일기를 조회한다. (보통 1개) | `/api/diaries?date=2025-09-09` | `GET` |
| `D-U-01` | **일기 수정** | 사용자는 자신이 작성했던 일기의 모든 내용을 수정할 수 있다. | `/api/diaries/{diary_id}` | `PUT` |
| `D-D-01` | **일기 삭제** | 사용자는 작성했던 일기를 삭제할 수 있다. | `/api/diaries/{diary_id}` | `DELETE` |

---

## 4. AI 연동 포인트

- **일기 작성 시 (`D-C-01`)**:
    - 사용자가 `감정`과 `날씨`를 쉽고 재미있게 선택할 수 있는 UI (아이콘 버튼 등)를 제공해야 한다.
    - 일기 또는 일정의 `내용`에서 핵심 **키워드를 자동으로 추출**한다. 이 내용은 AI 프롬프트의 품질을 결정하는 중요한 데이터가 된다.

- **일기 작성 완료 후**:
    - 일기 저장이 성공적으로 완료되면, 백엔드는 해당 일기 데이터를 기반으로 **AI 스몰토크 추천 생성** 로직을 비동기적으로 호출할 수 있다.
    - 생성된 스몰토크 주제는 별도의 테이블(`Small_Talk_Topic` 등)에 저장되어, 메인 화면이나 알림 기능에서 활용된다.